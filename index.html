<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Weird Peanut Clicker</title>
    <style>
        body {
            background-color: #f0f8ff;
            color: #333;
            font-family: 'Comic Sans MS', cursive, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            text-align: center;
            overflow: hidden;
            position: relative;
            perspective: 1000px;
        }

        .game-container {
            background-color: #fff;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            border: 5px solid #ffcc00;
            width: 90%;
            max-width: 600px;
            position: relative;
            z-index: 10;
            overflow: hidden;
            transition: background-color 1s ease-in-out;
        }

        h1 {
            color: #8b4513;
            text-shadow: 2px 2px #ffe4b5;
            font-size: 2.5em;
            animation: bounce 1s infinite;
        }

        .stats-container {
            display: flex;
            justify-content: space-around;
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #4b0082;
            position: relative;
            z-index: 15;
        }

        .peanut-container {
            position: relative;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 250px;
        }

        #peanut {
            cursor: pointer;
            width: 200px;
            height: auto;
            transition: transform 0.1s ease-out, filter 0.2s ease-in-out;
            will-change: transform;
            position: relative;
            z-index: 100;
            -webkit-user-drag: none; /* Prevent drag on some browsers */
            user-select: none; /* Prevent selection on click */
        }

        #peanut:hover {
            transform: scale(1.05) rotate(5deg);
        }

        #peanut:active {
            transform: scale(0.95) rotate(-5deg);
        }

        .pulsate-glow {
            animation: pulsate 2s infinite ease-in-out;
        }

        .message-container {
            margin-top: 20px;
            height: 50px;
            position: relative;
            z-index: 15;
        }

        #message {
            font-size: 1.8em;
            font-weight: bold;
            color: #d2691e;
            text-shadow: 1px 1px #fff;
        }

        .combo-counter {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 2em;
            font-weight: bold;
            color: #ff4500;
            text-shadow: 2px 2px #fff;
            opacity: 0;
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            z-index: 20;
        }

        .combo-active {
            opacity: 1;
            transform: scale(1.1);
        }

        .boss-peanut-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none; /* Changed from 'none' to 'flex' by JS */
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease-in-out;
        }

        .boss-peanut-container.active {
            display: flex;
            opacity: 1;
            pointer-events: all;
        }

        #bossPeanut {
            width: 400px;
            height: auto;
            animation: bossPulsate 1s infinite alternate;
            cursor: pointer;
            border: 5px solid #ff0000;
            border-radius: 50%;
            box-shadow: 0 0 50px red, 0 0 20px darkred;
            transition: transform 0.1s ease-out;
        }

        #bossPeanut:active {
            transform: scale(0.95);
        }

        #bossHpBar {
            width: 300px;
            height: 20px;
            background-color: grey;
            margin-top: 20px;
            border-radius: 10px;
            overflow: hidden;
        }

        #bossHp {
            height: 100%;
            width: 100%;
            background-color: limegreen;
            transition: width 0.1s linear;
        }

        .particle {
            position: absolute;
            pointer-events: none;
            font-size: 1.5em;
            animation: particleFadeOut 1s forwards;
            opacity: 0;
            z-index: 200;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes pulsate {
            0%, 100% { transform: scale(1); filter: drop-shadow(0 0 10px #ffcc00); }
            50% { transform: scale(1.05); filter: drop-shadow(0 0 20px #ffcc00); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) translateX(0); opacity: 1; }
            50% { transform: translateY(-20px) translateX(10px); opacity: 0.8; }
        }

        .floating-text {
            position: absolute;
            font-size: 2em;
            font-weight: bold;
            color: #8b0000;
            text-shadow: 1px 1px #fff;
            pointer-events: none;
            animation: float 1.5s ease-out forwards;
            z-index: 101;
        }

        .weird-effect {
            animation: weirdShake 0.5s infinite;
        }

        @keyframes weirdShake {
            0%, 100% { transform: translate(0, 0) rotate(0); }
            25% { transform: translate(5px, 5px) rotate(2deg); }
            50% { transform: translate(-5px, -5px) rotate(-2deg); }
            75% { transform: translate(5px, -5px) rotate(2deg); }
        }

        @keyframes bossPulsate {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
    </style>
</head>
<body>
    <div class="game-container" id="gameContainer">
        <h1>ðŸ¥œ The Weird Peanut Clicker ðŸ¥œ</h1>
        <div class="stats-container">
            <p>Score: <span id="score">0</span></p>
            <p>Clicks: <span id="clicks">0</span></p>
            <p>Power: <span id="powerLevel">1</span>x</p>
        </div>
        <div class="peanut-container">
            <img src="https://em-content.zobj.net/source/microsoft-teams/337/peanuts_1f95c.png" alt="A big peanut" id="peanut" class="pulsate-glow">
        </div>
        <div class="message-container">
            <p id="message"></p>
        </div>
        <div id="comboCounter" class="combo-counter"></div>
    </div>

    <div class="boss-peanut-container" id="bossPeanutContainer">
        <h2>BOSS PEANUT ATTACKS!</h2>
        <img src="https://em-content.zobj.net/source/microsoft-teams/337/peanuts_1f95c.png" alt="Giant Boss Peanut" id="bossPeanut">
        <div id="bossHpBar"><div id="bossHp"></div></div>
        <p id="bossMessage">Click the Boss Peanut to defeat it!</p>
    </div>

    <audio id="clickSound" src="https://assets.mixkit.co/sfx/preview/mixkit-fast-pop-click-1125.mp3"></audio>
    <audio id="comboSound" src="https://assets.mixkit.co/sfx/preview/mixkit-game-bonus-chime-and-ding-1994.mp3"></audio>
    <audio id="eventSound" src="https://assets.mixkit.co/sfx/preview/mixkit-retro-game-notification-sound-212.mp3"></audio>
    <audio id="negativeEventSound" src="https://assets.mixkit.co/sfx/preview/mixkit-negative-game-buzz-306.mp3"></audio>
    <audio id="bossSpawnSound" src="https://assets.mixkit.co/sfx/preview/mixkit-negative-game-impact-2096.mp3"></audio>
    <audio id="bossHitSound" src="https://assets.mixkit.co/sfx/preview/mixkit-quick-punch-2166.mp3"></audio>
    <audio id="bossDefeatSound" src="https://assets.mixkit.co/sfx/preview/mixkit-positive-game-over-tilt-2027.mp3"></audio>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const peanut = document.getElementById('peanut');
            const scoreDisplay = document.getElementById('score');
            const clicksDisplay = document.getElementById('clicks');
            const messageDisplay = document.getElementById('message');
            const comboCounter = document.getElementById('comboCounter');
            const powerLevelDisplay = document.getElementById('powerLevel');

            const bossPeanutContainer = document.getElementById('bossPeanutContainer');
            const bossPeanut = document.getElementById('bossPeanut');
            const bossHp = document.getElementById('bossHp');

            const clickSound = document.getElementById('clickSound');
            const comboSound = document.getElementById('comboSound');
            const eventSound = document.getElementById('eventSound');
            const negativeEventSound = document.getElementById('negativeEventSound');
            const bossSpawnSound = document.getElementById('bossSpawnSound');
            const bossHitSound = document.getElementById('bossHitSound');
            const bossDefeatSound = document.getElementById('bossDefeatSound');

            let score = 0;
            let clicks = 0;
            let comboCount = 0;
            let lastClickTime = Date.now();
            let clickMultiplier = 1;
            let peanutPowerLevel = 1;

            let bossModeActive = false;
            let bossHealth = 0;
            const MAX_BOSS_HEALTH = 20;

            peanut.addEventListener('click', (event) => {
                if (bossModeActive) return;
                
                playSound(clickSound);
                const currentTime = Date.now();
                
                if (currentTime - lastClickTime < 300) {
                    comboCount++;
                    if (comboCount > 2 && comboCount % 5 === 0) {
                        playSound(comboSound);
                    }
                } else {
                    comboCount = 0;
                }
                lastClickTime = currentTime;

                let points = peanutPowerLevel * clickMultiplier;
                
                if (comboCount > 2) {
                    points += Math.floor(comboCount / 3) * peanutPowerLevel;
                    comboCounter.textContent = `COMBO x${comboCount} (+${Math.floor(comboCount / 3) * peanutPowerLevel})`;
                    comboCounter.classList.add('combo-active');
                } else {
                    comboCounter.classList.remove('combo-active');
                }

                clicks++;
                score += points;
                updateScore();
                createFloatingText(`+${points}`, event);
                
                if (Math.random() < 0.08) {
                    triggerWeirdEvent();
                }

                if (!bossModeActive && score > 500 && Math.random() < 0.005) {
                    startBossFight();
                }
            });

            bossPeanut.addEventListener('click', (event) => {
                if (!bossModeActive) return;

                playSound(bossHitSound);
                bossHealth--;
                updateBossHpBar();
                createFloatingText('ðŸ’¥', event, '#ff0000', '3em');

                if (bossHealth <= 0) {
                    defeatBoss();
                }
            });

            function updateScore() {
                scoreDisplay.textContent = score;
                clicksDisplay.textContent = clicks;
                powerLevelDisplay.textContent = peanutPowerLevel;
            }

            function createFloatingText(text, event, color = '#8b0000', fontSize = '2em') {
                const floatingText = document.createElement('div');
                floatingText.textContent = text;
                floatingText.classList.add('floating-text');
                floatingText.style.color = color;
                floatingText.style.fontSize = fontSize;
                
                floatingText.style.left = `${event.clientX}px`;
                floatingText.style.top = `${event.clientY}px`;
                
                document.body.appendChild(floatingText);
                
                setTimeout(() => {
                    floatingText.remove();
                }, 1500);
            }

            function playSound(audioElement) {
                if (audioElement) {
                    audioElement.currentTime = 0;
                    audioElement.play().catch(e => console.log("Audio play failed:", e));
                }
            }

            const weirdEvents = [
                { 
                    message: "A tiny peanut army appears!", 
                    action: () => { 
                        score += 50 * peanutPowerLevel; updateScore(); showMessage('+50 score from the army!'); 
                        playSound(eventSound);
                    } 
                },
                { 
                    message: "A mysterious force multiplies your score!", 
                    action: () => { 
                        score *= 2; updateScore(); 
                        playSound(eventSound); 
                    } 
                },
                { 
                    message: "Oh no! A Peanut Thief steals some of your score!", 
                    action: () => { 
                        let stolen = Math.min(score, 50 * peanutPowerLevel);
                        score = Math.max(0, score - stolen); 
                        updateScore(); 
                        showMessage(`-${stolen} score stolen by the thief!`); 
                        playSound(negativeEventSound); 
                    } 
                },
                { 
                    message: "The peanut power-up is active! Clicks are 5x!", 
                    action: () => { 
                        clickMultiplier = 5; showMessage('Clicks are 5x for 5 seconds!'); 
                        playSound(eventSound); 
                        setTimeout(() => { clickMultiplier = 1; showMessage('Power-up faded.'); }, 5000); 
                    } 
                },
                { 
                    message: "The peanut turns into a pumpkin!", 
                    action: () => { 
                        peanut.src = 'https://em-content.zobj.net/source/microsoft-teams/337/jack-o-lantern_1f383.png'; 
                        showMessage('A pumpkin? How odd.'); 
                        playSound(eventSound); 
                        setTimeout(() => peanut.src = 'https://em-content.zobj.net/source/microsoft-teams/337/peanuts_1f95c.png', 5000); 
                    } 
                },
                { 
                    message: "The game glitches! You gain 100 clicks!", 
                    action: () => { 
                        clicks += 100; updateScore(); showMessage('+100 Clicks Glitch!'); 
                        playSound(eventSound); 
                    } 
                },
                { 
                    message: "The peanut starts to levitate!", 
                    action: () => { 
                        peanut.style.animation = 'float 2s infinite ease-in-out'; 
                        playSound(eventSound); 
                        showMessage('Whoa! Floating peanut!');
                        setTimeout(() => peanut.style.animation = 'none', 5000); 
                    } 
                },
                {
                    message: "A cosmic entity blesses your peanut! Permanent power-up!",
                    action: () => {
                        peanutPowerLevel++;
                        updateScore();
                        showMessage(`Peanut Power Level increased to ${peanutPowerLevel}x!`);
                        playSound(eventSound);
                    }
                }
            ];

            function showMessage(msg) {
                messageDisplay.textContent = msg;
                setTimeout(() => {
                    messageDisplay.textContent = '';
                }, 4000);
            }

            function triggerWeirdEvent() {
                const randomEvent = weirdEvents[Math.floor(Math.random() * weirdEvents.length)];
                showMessage(randomEvent.message);
                randomEvent.action();
            }

            function startBossFight() {
                bossModeActive = true;
                bossHealth = MAX_BOSS_HEALTH;
                updateBossHpBar();
                bossPeanutContainer.classList.add('active');
                showMessage('A HUGE BOSS PEANUT APPEARS! DEFEAT IT!');
                playSound(bossSpawnSound);
                peanut.style.pointerEvents = 'none';
            }

            function updateBossHpBar() {
                const hpPercent = (bossHealth / MAX_BOSS_HEALTH) * 100;
                bossHp.style.width = `${hpPercent}%`;
                bossHp.style.backgroundColor = hpPercent > 50 ? 'limegreen' : (hpPercent > 20 ? 'orange' : 'red');
            }

            function defeatBoss() {
                bossModeActive = false;
                bossPeanutContainer.classList.remove('active');
                peanut.style.pointerEvents = 'auto';

                const bossReward = 500 * peanutPowerLevel;
                score += bossReward;
                peanutPowerLevel++;
                updateScore();
                playSound(bossDefeatSound);
                showMessage(`BOSS PEANUT DEFEATED! You gained ${bossReward} score and +1 Peanut Power!`);
                
                bossHp.style.width = '100%';
                bossHp.style.backgroundColor = 'limegreen';
            }

            updateScore();
        });
    </script>
</body>
</html>
